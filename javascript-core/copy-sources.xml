<project name="core-copy-sources" default="create-sources">
	
	<property name="javascript.maven.sources" location="${ant.file.core-copy-sources}/../src" />
	
	<target name="clean-sources">
		<mkdir dir="${javascript.maven.sources}" />
		<delete dir="${javascript.maven.sources}" />
		<mkdir dir="${javascript.maven.sources}" />
	</target>
	<target name="copy-sources">
		<fail unless="core.javascript.path" message="You must specify a path to the core javascript in the core.javascript.path property" />
		<property name="core.javascript.path" location="${ant.file.core-copy-sources}/../../javascript" />
		<condition property="build.failed">
			<not><available file="${core.javascript.path}" /></not>
		</condition>
		<fail if="build.failed" message="Couldn't find JavaScript: ${core.javascript.path}" />
		<property name="core.iedoc.js" location="${core.javascript.path}/iedoc.js" />
		<condition property="build.failed">
			<not><available file="${core.iedoc.js}" /></not>
		</condition>
		<fail if="build.failed" message="Couldn't find iedoc.js: ${core.iedoc.js}" />
		<mkdir dir="${javascript.maven.sources}" />
		<copy todir="${javascript.maven.sources}">
			<fileset dir="${core.javascript.path}" />
		</copy>
	</target>
	<target name="generate-xml">
		<exec executable="cscript" dir="${javascript.maven.sources}" output="${javascript.maven.sources}/iedoc.xml" failonerror="true">
			<arg value="/nologo"/>
			<arg file="${javascript.maven.sources}/iedoc.js"/> 
		</exec>
		<xmlvalidate file="${javascript.maven.sources}/iedoc.xml" lenient="true"/>
	</target>
	
	<target name="create-sources" depends="copy-sources,generate-xml"/>
</project>