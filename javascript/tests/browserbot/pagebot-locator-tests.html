<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
  <head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>JsUnit Utility Tests</title>
    <link rel="stylesheet" type="text/css" href="/jsunit/css/jsUnitStyle.css">
<script language="JavaScript" type="text/javascript" src="/jsunit/app/jsUnitCore.js"></script>
<script language="JavaScript" type="text/javascript" src="/jsmock/mock.js"></script>

<script language="JavaScript" type="text/javascript" src="/selenium-browserbot.js"></script>
<script language="JavaScript" type="text/javascript" src="/htmlutils.js"></script>
<script language="JavaScript" type="text/javascript">

function setUp() {
    pageBot = new PageBot(window);
    element1 = document.getElementById("id1");
    element2 = document.getElementById("id2");
    element3 = document.getElementById("id3");
    element4 = document.getElementById("document.links[0]");
}

//
// Tests for PageBot.findIdentifiedElement()
//
function testFindIdentifiedElementReturnsNullIfElementNotPresent() {
    assertNull(pageBot.findIdentifiedElement('noSuchElement'));
}

function testFindIdentifiedElementReturnsHtmlElementWithMatchingId() {
    assertEquals(element3, pageBot.findIdentifiedElement('id3'));
}

function testFindIdentifiedElementReturnsFirstElementWithMatchingName() {
    assertEquals(element2, pageBot.findIdentifiedElement('name1'));
}

function testFindIdentifiedElementIsCaseSensitiveOnId() {
    assertNull(pageBot.findIdentifiedElement('ID3'));
}

function testFindIdentifiedElementIsCaseSensitiveOnName() {
    assertNull(pageBot.findIdentifiedElement('NAME1'));
}

//
// Tests for PageBot.findElementByDomTraversal
//
function testFindElementByDomTraversal() {
    assertEquals(element2,
                 pageBot.findElementByDomTraversal("links[1]"))
}

function testFindElementByDomTraversalStripsLeadingDocument() {
    assertEquals(element2,
                 pageBot.findElementByDomTraversal("document.links[1]"))
}

function testFindElementByDomTraversalReturnsNullForNoMatchingElement() {
    assertNull(pageBot.findElementByDomTraversal("document.links[3]"))
}

function testFindElementByDomTraversalFailsWithInvalidDomString() {
    try {
        pageBot.findElementByDomTraversal("document.foo.bar");
        fail("Should have thrown exception");
    }
    catch (e) {
        // Expected
    }
}

//
// Tests for PageBot.findElement()
//
function testFindElementReturnsElementWithMatchingIdentifier() {
    assertEquals(element2, pageBot.findElement("id2"));
}

function testFindElementReturnsMatchingName() {
    assertEquals(element2, pageBot.findElement("name1"));
}

function testFindElementLooksForIdentifiedElementBeforeDomTraversal() {
    assertEquals(element4, pageBot.findElement("document.links[0]"));
}

function testUnknownElementWithoutDomTraversal() {
    try {
        pageBot.findElement("unknownElement");
        fail("Should have failed for element not found");
    }
    catch (e) {
        // expected
    }
}

function testUnknownElementWithDomTraversal() {
    try {
        pageBot.findElement("document.foo");
        fail("Should have failed for element not found");
    }
    catch (e) {
        // expected
    }
}

function testFindElementHandlesDomTraversal() {
    assertEquals(element3, pageBot.findElement("document.links[2]"));
}
</script>
  </head>

  <body>
    <a id="id1" href="#id1">this is the first element</a>
    <a id="id2" name="name1" href="#id2">this is the second element</a>
    <a id="id3" name="name1" href="#id3">this is the third element</a>

    <p id="document.links[0]">dummy element</p>
  </body>
</html>
