<project name="java-client-driver-generate-sources" default="generate-sources">
	
	<property name="javascript.maven.sources" location="${ant.file.java-client-driver-generate-sources}/../src/selenium" />
	
	<target name="clean-sources">
		<delete file="${maven.src.path}/Selenium.java" />
		<delete file="${maven.src.path}/DefaultSelenium.java" />
	</target>
	<target name="generate-sources" depends="extract-xml" unless="skip.generation.true">
		<fail unless="maven.src.path" message="maven.src.path was not set.  This ant script must be run from within Maven!" />
		<fail message="maven.src.path could not be found: ${maven.src.path}">
			<condition>
				<not><available file="${maven.src.path}" /></not>
			</condition>
		</fail>
		<echo message="maven.src.path = ${maven.src.path}" />
		<xslt in="${iedoc.xml}" out="${maven.src.path}/Selenium.java" style="iedoc2java.xml">
			<param name="mode" expression="interface" />
		</xslt>
		<xslt in="${iedoc.xml}" out="${maven.src.path}/DefaultSelenium.java" style="iedoc2java.xml">
			<param name="mode" expression="implementation" />
		</xslt>
	</target>
	<target name="extract-xml" depends="maybe-skip-generation" unless="skip.generation.true">
		<fail unless="output.path" message="output.path was not set.  This ant script must be run from within Maven!" />
		<mkdir dir="${output.path}" />
		<echo message="${depend.maven.path}" file="${output.path}/path.txt" />
		<loadfile property="depend.classpath.str" srcfile="${output.path}/path.txt">
			<filterchain>
				<tokenfilter>
					<replaceregex pattern="^.*\[(.*)\]" replace="\1" />
				</tokenfilter>
				<tokenfilter>
					<replaceregex pattern=", " replace=";" flags="g" />
				</tokenfilter>
			</filterchain>
		</loadfile>
		<!--<echo message="depend.classpath.str = ${depend.classpath.str}" />-->
		<path id="depend.classpath">
			<pathelement path="${depend.classpath.str}" />
		</path>
		<pathconvert property="depend.classpath.output" refid="depend.classpath" />
		<!--<echo message="depend.classpath.output = ${depend.classpath.output}" />-->
		<whichresource resource="/core/iedoc.xml" property="iedoc.url" classpath="${depend.classpath.output}"/>
		<fail unless="iedoc.url" message="Couldn't find iedoc.xml in the classpath: ${depend.classpath.output}" />
		<!--<echo message="iedoc.url = ${iedoc.url}" />-->
		<get src="${iedoc.url}" dest="${output.path}/iedoc.xml" />
		<property name="iedoc.xml" location="${output.path}/iedoc.xml" />
	</target>
	
	<target name="maybe-skip-generation" if="skip.generation">
		<condition property="skip.generation.true">
			<istrue value="${skip.generation}" />
		</condition>
	</target>
	
</project>