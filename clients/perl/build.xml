<project name="selenium" default="generate-sources">
	<target name="init">
		<property environment="env" />
		<property name="env.PERL5LIB" value="" />
		<property name="perl.executable" value="perl" />
		<presetdef name="perl">
			<exec executable="${perl.executable}" failonerror="true">
				<env key="PERL5LIB" value="${env.PERL5LIB}" />
			</exec>
		</presetdef>
		<!-- Cygwin make won't work with the auto-generated Makefile -->
		<condition property="make.executable" value="nmake">
			<os family="windows" />
		</condition>
		<property name="make.executable" value="make" />
		<presetdef name="make">
			<exec executable="${make.executable}" failonerror="true">
				<env key="PERL5LIB" value="${env.PERL5LIB}" />
			</exec>
		</presetdef>
		<!-- <perl>
			<arg value="-e" />
			<arg value="print qq(@INC);" />
		</perl>-->
	</target>
	<target name="generate-sources">
    	<ant dir=".." target="extract-xml"/>
    	<mkdir dir="lib/WWW" />
    	<xslt in="../iedoc.xml" out="lib/WWW/Selenium.pm" style="iedoc2perl.xml"/>
    </target>
    <target name="doc" depends="init, generate-sources">
    	<mkdir dir="html"/>
    	<property name="outfile.www.selenium" location="html/WWW-Selenium.html" />
    	<perl>
			<arg value="mypod2html.pl"/>
			<arg value="--infile=lib/WWW/Selenium.pm" />
			<arg value="--outfile=${outfile.www.selenium}" />
		</perl>
		<property name="outfile.test.www.selenium" location="html/Test-WWW-Selenium.html" />
    	<perl>
			<arg value="mypod2html.pl"/>
			<arg value="--infile=lib/Test/WWW/Selenium.pm" />
			<arg value="--outfile=${outfile.test.www.selenium}" />
		</perl>
    </target>
    <target name="all" depends="generate-sources, test, doc"/>
    <target name="make" depends="init, generate-sources">
    	<perl>
    		<arg value="Makefile.PL" />
    	</perl>
    	<make />
    </target>
    <target name="test" depends="init, make">
    	<ant dir=".." target="start-server" />
        <make failonerror="false" resultproperty="result">
        	<arg value="test" />
        </make>
        <ant dir=".." target="stop-server" />
        <condition property="build.failed">
        	<not><equals arg1="0" arg2="${result}" /></not>
        </condition>
        <fail if="build.failed" message="perl tests failed!" />
    </target>
    <target name="clean">
    	<mkdir dir="lib/WWW" />
    	<delete dir="lib/WWW" />
    	<mkdir dir="html" />
    	<delete dir="html" />
    	<mkdir dir="blib" />
    	<delete dir="blib" />
    </target>
</project>
