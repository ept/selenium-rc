<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.openqa.selenium</groupId>
        <version>1.0-SNAPSHOT</version>
        <artifactId>selenium-rc</artifactId>
    </parent>
    <groupId>org.openqa.selenium.tests</groupId>
    <artifactId>selenium-generated-tests</artifactId>
    <packaging>jar</packaging>
    <name>Selenium Generated Tests</name>
    <repositories>
        <repository>
            <id>openqa-releases</id>
            <name>OpenQA Releases</name>
            <url>http://archiva.openqa.org/repository/releases/</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
        <repository>
            <id>openqa-snapshots</id>
            <name>OpenQA Snapshots</name>
            <url>http://archiva.openqa.org/repository/snapshots/</url>
            <releases>
                <enabled>false</enabled>
            </releases>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </repository>
        <repository>
            <id>openqa-thirdparty</id>
            <name>OpenQA Third Party</name>
            <url>http://archiva.openqa.org/repository/thirdparty/</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
    </repositories>
    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <configuration>
                    <source>1.5</source>
                    <target>1.5</target>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-plugin</artifactId>
                <configuration>
                    <skip>true</skip>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-surefire-report-plugin</artifactId>
                <configuration>
                    <skip>true</skip>
                  <showSuccess>false</showSuccess> <!-- Failures Only -->
                </configuration>
            </plugin>
            <plugin>
                <artifactId>maven-antrun-plugin</artifactId>
                <version>1.2-SNAPSHOT</version>
                <executions>
                    <execution>
                        <id>generate-test-sources</id>
                        <phase>generate-test-sources</phase>
                        <configuration>
                            <tasks>
                                <ant antfile="generate-sources.xml" target="ant-generate-tests" inheritrefs="true">
                                    <property name="selenium-server"
                                              value="${maven.dependency.org.openqa.selenium.server.selenium-server.standalone.jar.path}"/>
                                </ant>
                            </tasks>
                            <sourceRoot>${project.build.directory}/generated-sources/main/java</sourceRoot>
                            <testSourceRoot>${project.build.directory}/generated-sources/test/java</testSourceRoot>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                    <execution>
                        <id>test-junit</id>
                        <phase>test</phase>
                        <configuration>
                            <tasks>
                              <!-- START SELENIUM SERVER -->
                              <java jar="${maven.dependency.org.openqa.selenium.server.selenium-server.standalone.jar.path}" fork="true" spawn="true"/>
                              
                              <mkdir dir="target/surefire-reports" />
                              <junit printSummary="withOutAndErr" failureproperty="failed" haltonerror="false" haltonfailure="false" fork="true" dir="target/surefire-reports">
                                <sysproperty key="selenium.defaultBrowser" value="${selenium.defaultBrowser}" />
                                <classpath refid="maven.test.classpath"/>
                                <formatter type="xml"/>
                                <formatter type="plain"/>
                                <batchtest todir="target/surefire-reports">
                                  <fileset dir="target/test-classes">
                                    <include name="**/*Test.class"/>
                                    <include name="**/Test*.class"/>
                                    
                                    <exclude name="**/thirdparty/**" />
                                    
                                    <!-- failing tests -->
                                    <exclude name="**/TestModalDialog.class" /> <!-- runs IE proprietary showModalDialog; hangs the browser -->
                                    <exclude name="**/TestXPathLocatorInXHtml.class" /> <!-- fails in IE, which doesn't support XHTML -->
                                    <exclude name="**/TestCursorPosition.class" /> <!-- frequently fails on FF (only succeeds if the window has focus -->
                                    <exclude name="**/TestUserExtensions.class" /> <!-- tests sample user extensions -->
                                    
                                    <!-- Tests Hanging the Build -->
                                    <exclude name="**/TestProxy.class" />
                                  </fileset>
                                </batchtest>
                              </junit>
                              
                              <!-- STOP SELENIUM SERVER -->
                              <get taskname="selenium-shutdown" src="http://localhost:4444/selenium-server/driver/?cmd=shutDown" dest="target/shutdown-result.txt" ignoreerrors="true" />
                              <fail message="tests failed!" if="failed" />
                            </tasks>
                        </configuration>
                        <goals>
                            <goal>run</goal>
                        </goals>
                    </execution>
                </executions>
                <dependencies>
                    <dependency>
                        <groupId>org.apache.ant</groupId>
                        <artifactId>ant-nodeps</artifactId>
                        <version>1.7.0</version>
                    </dependency>
                    <dependency>
                        <groupId>org.apache.ant</groupId>
                        <artifactId>ant-junit</artifactId>
                        <version>1.7.0</version>
                    </dependency>
                    <dependency>
                        <groupId>junit</groupId>
                        <artifactId>junit</artifactId>
                        <version>4.4</version>
                    </dependency>
                    <!--<dependency>
                             <groupId>org.openqa.selenium</groupId>
                             <artifactId>selenium-xlator</artifactId>
                             <version>${project.version}</version>
                         </dependency>-->
                </dependencies>
            </plugin>
        </plugins>
    </build>
    <dependencies>
        <dependency>
            <groupId>org.openqa.selenium.client-drivers</groupId>
            <artifactId>selenium-java-client-driver</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
		    <groupId>org.openqa.selenium.server</groupId>
		    <artifactId>selenium-server</artifactId>
		    <classifier>standalone</classifier>
		    <version>${project.version}</version>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
        </dependency>
    </dependencies>
</project>
